# 第10章 程序结构

## 10.1 局部变量

我们把声明在函数体内的变量称为该函数的局部变量。

局部变量具有以下默认性质：

* **自动存储期限**：变量的**自动存储期限**是在变量存储单元存在期内程序执行的部分。局部变量的存储单元是在包含该变量的函数被调用时自动分配的，函数返回时收回分配，所以称这种变量具有**自动的存储期限**。包含局部变量的函数返回时，局部变量的值无法保留。
* **块作用域**：变量的作用域是可以引用该变量的程序文本部分。局部变量拥有块作用域：从变量声明的点开始一直到所在函数体的末尾。因为局部变量的作用域不能延伸到所在函数之外，所以其他函数可以把同名变量用于别的用途。

C99不要求在函数一开始就进行局部变量声明，所以局部变量的作用域可能非常小。

### 10.1.1 静态局部变量

在局部变量声明中放置单词static可以使变量具有**静态存储期限**而不再是**自动存储期限**。因为**具有静态存储期限的变量拥有永久的存储单元，所以在整个程序执行期间都会保留变量的值**。

静态变量是对其他函数隐藏数据的地方，但是他会为将来同一个函数的再调用保留这些数据。

### 10.1.2 形式参数

形式参数拥有和局部变量一样的性质：自动存储期限和块作用域。

形式参数和局部变量的唯一真正区别：**在每次函数调用时对形式参数自动进行初始化**。

## 10.2 外部变量

函数还可以通过外部变量进行通信。**外部变量**是声明在任何函数体之外的变量。

外部变量（全局变量）的性质不同于局部变量：

* 静态存储期限：存储在外部变量中的值将永久的保存下来。
* 文件作用域：从变量被声明的点开始一直到所在文件的末尾。

### 10.2.1 示例：用外部变量实现栈

C语言中实现栈的一种方法就是把元素存储在数组中。

### 10.2.2 外部变量的利与弊

大多数情况下，对于函数而言，通过形式参数进行通信比通过共享变量的方法更好。

## 10.3 程序块

程序块：`{ 多条声明 多条语句 }`

默认情况下，声明在程序块中的变量的存储期限是自动的：**进入程序块时为变量分配存储单元，退出程序块时回收分配的空间**。变量具有块作用域，也就是说，不能在程序块外引用。

函数体就是程序块。C99允许在程序块的任何地方声明变量，就像允许在函数体内的任何地方声明变量一样。

## 10.4 作用域

<u>**当程序块内的声明命名一个标识符时，如果此标识符已经是可见的，新的声明临时隐藏了旧的声明，标识符获得了新的含义。在程序块的末尾，标识符重新获得旧的含义。**</u>

## 10.5 构建C程序

程序可以包含：

* 诸如#include和#define这样的预处理指令；
* 类型定义；
* 外部变量声明；
* 函数原型；
* 函数定义。

**执行到预处理指令所在的代码行时，预处理指令才会起作用；类型名定义后才可以使用；变量声明后才可以使用；在第一次调用函数前要对每个函数进行定义和声明。**

为了遵守规则，下面是建议的程序编写顺序：

* #include指令；
* #define指令；
* 类型定义；
* 外部变量的声明；
* 除main函数之外的函数的原型声明；
* main函数的定义；
* 其他函数的定义；

最后建议：在每个函数的定义前放置注释可以给出函数名和函数功能概述等等辅助理解的文本。