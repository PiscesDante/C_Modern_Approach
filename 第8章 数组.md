# 第8章 数组

目前为止我们所涉及的变量都是「标量」：**标量具有保存单一数据项的能力** 。

C 语言也支持「聚合变量」，这类变量可以存储一组的数据。C 语言中一共有两种聚合类型： **数组** 和 **结构** 。

## 8.1 一维数组

数组是含有多个数据值的数据结构，并且每个数据值具有相同的类型。这些数据值称为元素，可以根据元素在数组中的所处位置把它们一个个的选出来，这种方法有个学名叫做「寻秩访问」。

为了声明数组，需要指明数组元素的类型和数量。

```C++
int arr[10]; // 声明数组 arr 有 10 个 int 类型的元素
```

数组元素可以是任何类型，数组的长度可以用任何整数常量表达式指定。因为程序以后可能需要调整数组的长度，所以较好的方法是使用宏来定义数组的长度：

```C++
#define LEN 10
int arr[LEN];
```

### 8.1.1 数组下标

为了存取特定的数组元素，可以在写数组名的同时在后面加上一个用方括号包围的整数值，这种方法称为 **对数组取下标** 或者 **对数组进行索引** 。数组元素从 `0` 开始，所以长度为 `n` 的数组元素的索引范围是从 `0` 到 `n-1` 。

形如 `a[i]` 的表达式是左值，所以数组元素可以像普通变量一样使用：

```C++
a[i] = 1;
printf("%d\n", a[5]);
++a[i];
```

如果数组包含 `T` 类型的元素，那么数组中的每个元素均视为 `T` 类型的变量。

注意：这里在调用 `scanf` 函数读取数组元素时，就像对待普通变量一样，必须使用取地址符 `&` 。

#### 程序：数列反向

```C++
/*******************************
 * Reverse a series of numbers *
 *******************************/

#include <stdio.h>

#define LENGTH_OF_ARRAY 10

int main(int argc, char const *argv[])
{
    int arr[LENGTH_OF_ARRAY];
    int begin = 0;
    int end = LENGTH_OF_ARRAY - 1;
    int temp = 0;
    printf("Enter 10 numbers: ");
    for (int i = 0; i < 10; ++i) scanf("%d", &arr[i]);
    while (begin < end) { // Reverse
        temp = arr[begin];
        arr[begin++] = arr[end];
        arr[end--] = temp;
    }
    printf("In reverse order: ");
    for (int i = 0; i < 10; ++i) printf("%d ", arr[i]);
    printf("\n");
    return 0;
}

// output:
// Enter 10 numbers: 34 82 49 102 7 94 23 11 50 31
// In reverse order: 31 50 11 23 94 7 102 49 82 34
```

### 8.1.2 数组初始化

**数组初始化式** 最常见的格式是用一个大括号括起来的常量表达式列表，常量表达式之间用逗号进行分隔：

```C++
int arr[10] = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 }; // 数组初始化式
```

**如果初始化式比数组短，那么数组中剩余的元素赋值为 `0`** ：

```C++
int arr[5] = { 1, 2, 3 };
// initial value of this array is: 1, 2, 3, 0, 0
```

利用这个特性，可以很容易的把数组全初始化为 `0` ：

```C++
int arr[10] = { 0 };
// initial value of this array is: 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
```

* **初始化式完全为空是非法的** ，所以要在大括号内放上一个 `0` 。
* **初始化式长度比数组长度大也是非法的** ！

在初始化的过程中，如果可以明确的给出初始化式，可以省略掉数的长度：

```C++
int arr[] = { 1, 2, 3, 4, 5 };
// 数组的长度是 5 ，编译器利用初始化式的长度来确定数组的大小
```

### 8.1.3  指定初始化式（ C99 ）

C99 中的指定初始化式可以用于解决这一问题。上面的例子可以使用指定初始化式：

```C++
int arr[15] = { [2] = 29, [9] = 7, [14] = 48 };
```

括号中的数字称为「指示符」，这样初始化的数组除了索引为 `2` ，`9` ，`14` 的元素以外全部为 `0` 。

指示符必须是整型常量表达式。

#### 程序：检查数中重复出现的数字

```C++
/****************************************
 * Check if there is any repeated digit *
 ****************************************/

#include <stdio.h>

#define LENGTH_OF_ARRAY 10

int main(int argc, char const *argv[])
{
    int digits[LENGTH_OF_ARRAY] = { 0 };
    printf("Enter a number: ");
    char ch;
    while ((ch = getchar()) != '\n') {
        digits[ch - '0'] += 1;
        if (digits[ch - '0'] > 1) {
            printf("Repeated digit: %d.\n", (ch - '0'));
            return 0;
        }
    }
    printf("No repeated digit.\n");
    return 0;
}

// output:
// Enter a number: 28212
// Repeated digit: 2.
// output:
// Enter a number: 9537
// No repeated digit.
```

### 8.1.4 对数组使用 `sizeof` 运算符

运算符 `sizeof` 可以确定数组的大小（字节数）。如果数组 `a` 有 `10` 个整数，那么 `sizeof(a)` 通常为 `40` （ 32 位的 `int` ）。

还可以使用 `sizeof` 来计算数组元素的大小。**用数组的大小除以数组元素的大小可以得到数组的长度** ：`sizeof(a) / sizeof(a[0])` 。

## 8.2 多维数组

数组可以有任意维数。该声明产生一个二维数组： `int mat[5][9];` 。表示该二维数组有 5 行 9 列。

为了访问 `i` 行 `j` 列中的元素，需要写成 `mat[i][j]` 的形式。

虽然我们以表格的形式显示二维数组，但是实际上它们在计算机内存中不是这样存储的。C 语言是按照 **行主序** 存储数组的：从第 `0` 行开始，接着第 `1` 行，依此类推。

C 语言为存储多维数据提供了更加灵活的方法：指针数组。

### 8.2.1 多维数组初始化

通过嵌套一维初始化列表的方式可以产生二维数组的初始化式。

* 如果初始化式没有大到足以填满整个多维数组，那么把数组中剩余的元素赋值为 `0` 。
* 如果内层的列表没有大到足以填满数组的一行，那么把此行剩余的元素初始化为 `0` 。
* 甚至可以省略掉内层的花括号，因为一旦编译器发现数值足以填满一行，它就开始填充下一行。但是这种做法是非常危险的，因为额外的元素会影响剩下的初始化式。

### 8.2.2 常量数组

无论一维数组还是多维数组，都可以通过在声明的最开始处加上单词 `const` 而成为常量。程序不应当对常量数组中的元素进行修改。

`const` 类型限定符不仅仅限于数组，后面将看到，它可以和任何变量一起使用。

## 8.3 C99 中的变长数组

* 数组变量的长度这里也可以使用非常量的表达式进行定义。
* 变长数组的长度是在程序执行时进行计算的，而不是在程序编译的时候。