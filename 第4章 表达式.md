# 第4章 表达式

表达式的概念：如何计算值的公式。最简单的表达式是变量和常量。

## 4.1 算术运算符

算术运算符：包括C语言在内的许多编程语言中都广泛应用的一种运算符，这类运算符可以执行加法、减法、乘法和除法。

加法类运算符和乘法类运算符都属于二元运算符，因为它们需要两个操作数。

除法运算符和取余运算符需要注意以下几点：

* 除法运算符可能产生意外的结果。**当两个操作数都是整数时，除法运算符会丢掉小数部分来截取结果，这个现象叫做“截断”。**
* 取余运算符要求操作数是整数。如果两个操作数中有一个不是整数，程序将无法编译通过。
* 把零作为这两个操作符的右操作符是未定义的行为。
* 当负数作用于这两个操作符时，结果也是未定义的。但是C99中除法的结果总是向零截取。

#### 运算符的优先级和结合性

算术运算符的相对优先级如下：

* 最高优先级：+（一元）、-（一元）、*、/、%
* 最低优先级：+（二元）、-（二元）

当表达式包含两个或者更多相同优先级的运算符时，仅有运算符优先级的规则是不够的。这种情况下，运算符的结合性开始发挥作用。如果**运算符是从左向右结合的，那么称这种运算符是左结合的**。二元算术运算符都是左结合的。

如果运算符是从右向左结合的，那么称这种运算符是右结合的。一元运算符都是右结合的。

## 4.2 赋值运算符

### 4.2.1 简单赋值

表达式`v = e`的赋值效果是求出表达式e的值，并且把该值复制给v。

在许多变成语言中，赋值是语句；然而在C语言中，赋值就像+那样是运算符。赋值操作产生结果，这就如同两个数相加产生结果一样。赋值表达式`v = e`的值就是赋值运算后v的值。

简单赋值运算符是第一个已知的有副作用的运算符，它改变了运算符的左操作数。对表达式`i = 0`求值产生的结果为0，并（作为副作用）把0赋值给i。

既然赋值是运算符，那么就可以串联赋值：`i = j = k = 10;`，赋值运算符是右结合的。

```C
// 例子：
int i = 1; // 1
int j = 10; // 10
int k = 1 + (j = i); // 先将i赋值给j，所以现在i，j，k分别为1，1，2
```

### 4.2.2 左值

赋值运算符要求它的左操作数必须是左值。左值表示**存储在计算机内的对象**，而不是常量或者计算的结果。

### 4.2.3 复合赋值

复合运算符有着和赋值运算符一样的特性。它们都是右结合的。所以语句`i += j += k;`等价于`i += (j += k);`。

## 4.3 自增运算符和自减运算符

C语言允许使用++（自增）和--（自减）运算符来计算。这两个符号也有**副作用：它们会改变操作数的值**。

计算表达式`++i`的结果是`i + 1`，而副作用的效果是自增i。

需要记住的是：后缀运算符比一元的正负号优先级高，而且都是左结合的。前缀运算符与一元正负优先级相同。且都是右结合的。

## 4.4 表达式求值

#### 子表达式的求值顺序

如果两个相同优先级的子表达式中有对方的运算子对象，那么这个整体表达式的求值很可能是未定义的。

#### 未定义行为

程序中出现未定义的行为时，后果是不可预料的。不同的编译器给出的编译结果可能是不同的，且有可能根本无法通过编译。应该彻底避免未定义行为的发生。

## 4.5 表达式语句

任何表达式都可以作为语句。即**无论表达式是什么类型，计算什么结果，都可以通过在后面添加分号将其转换为语句**。通常的情况是**丢掉表达式的返回值，然后执行副作用**，类似`1 + 1;`的表达式没有任何副作用时，就什么都不会发生。

