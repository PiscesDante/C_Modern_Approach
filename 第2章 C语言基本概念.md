# 第2章 C 语言基本概念

主要内容有 **预处理指令** 、**函数** 、**变量** 和 **语句** 。程序需要 **编译** 和 **链接** 。

* 变量是用来存储程序执行过程中可能会发生改变的数据的。
* 常量是程序执行过程中不会发生改变的数据。

## 2.1 编写一个简单的 C 程序

```C
#include <stdio.h> // 包含了C语言输入输出标准库的相关信息

int main(int argc, char const *argv[])
{
    // 显示期望信息，printf 函数来自标准输入输出库
    // 产生格式化输出
    printf("To C, or not to C: that is the question.\n");
    return 0;
}
```

第一行是必不可少的。它包含进来了标准库的输入输出相关信息。程序的可执行代码都在主函数 `main` 中。 `printf` 函数来自标准输入输出库。最后一句表明程序终止时会向操作系统返回 `0` 。

### 2.1.1 编译和链接

把 C 语言程序转换为机器可以执行的形式需要以下三个步骤：

* **预处理** ：首先程序回被交给 **预处理器（ preprocessor ）** 。预处理器执行以 `#` 开头的命令（ 通常称为 **指令** ）。预处理器有点类似于编辑器，它可以给程序添加内容，也可以对程序进行修改。
* **编译** ：修改后的程序被交给 **编译器（ compiler ）** 。编译器会把程序翻译成机器指令。当然现在程序还是不可以运行的。
* **链接** ：链接器（ linker ）把由编译器产生的目标代码和所需的其他附加代码整合在一起，这样才产生了可执行的程序。

### 2.1.2 集成开发环境

集成开发环境是一个软件包，我们可以在其中编辑、编译、链接、执行甚至调试程序。

## 2.2 简单程序的一般形式

简单的C程序一般有如下形式：

```C
// 指令

int main(int argc, char* argv[])
{
    // 语句
}
```

C 语言程序依赖三个关键的语言特性：

* 指令：在编译前修改程序的编辑命令。
* 函数：被命名的可执行代码块，如 `main` 函数。
* 语句：程序运行时执行的命令。

### 2.2.1 指令

预处理器会首先对其进行编辑。我们把 **预处理器执行的命令** 称为 **指令** 。

所有的指令都是以字符 `#` 开始的。这个字符可以把 C 程序中的指令和其他代码区分开来。 **指令默认只占一行，每条指令的结尾没有分号或者其他特殊标记** 。

### 2.2.2 函数

函数类似于其他变成语言中的 **过程** 。它们是用来构建程序的构件块。**C 程序就是函数的集合** 。

函数分为两大类：

* 程序员自己编写的函数。
* 作为 C 语言实现的一部分提供的函数。也就是库函数。

虽然一个 C 程序可以包含多个函数，但是 `main` 函数是必须有的。`main` 函数是非常特殊的：**在执行程序时系统会自动地调用 `main` 函数** 。

### 2.2.3 语句

语句就是程序运行时执行的命令。比方说上述程序中使用到的返回语句和函数调用语句。函数调用语句的作用就是分派给一个函数它要执行的任务。

C 语言规定每条语句都必须以分号结尾，因为语句可以连续占用多行。指令通常只占一行，因此不需要使用分号结尾。

### 2.2.4 显示字符串

目前为止我们只使用了 `printf` 函数显示了一条字符串字面量——用一对引号包围的一系列字符。

## 2.3 注释

每一个程序都应该包含识别信息，C 语言把这类信息放在注释中。符号 `/*` 标记注释的开始，而符号 `*/` 标记注释的结束。注释符号不能嵌套。但可以占据多行。

建议的两个注释方式：

```C
/*****************************
 * Name: pun.c
 * Purpose: Prints a bad pun    // 块注释
 * Author: K. N. King
 *****************************/

/* Beginning of main program */ // 单行注释
```

`//` 是 C99 提供的另一种类型的注释，这种方法只作用于一行，所以不会出现未终止的注释符号意外吞噬部分程序的情况。

## 2.4 变量和赋值

### 2.4.1 类型

**每一个变量必须有一个类型** 。类型用来说明变量所存储的数据的种类。类型会影响变量的存储方式以及允许对变量进行的操作，所以选择合适的类型是非常关键的。数值型变量的类型决定了变量所能存储的最大值和最小值，同时也决定了是否允许在小数点后出现数字。

浮点型变量所存储的数值往往只是实际数值的一个 **近似值** 。

### 2.4.2 声明

**在使用变量之前必须对其进行声明（为编译器所做的描述）** 。为了声明变量，首先要指定变量的类型，然后说明变量的名字。

注意每一条完整的声明语句都要以分号结尾。

在 `main` 函数的第一个模版中并没有包含声明。 **但 `main` 函数包含声明时，必须把声明放置在语句之前** ：

```C
int main(int argc, char const *argv[])
{
    // 声明块

    // 语句块
    return 0;
}
```

这里书写格式的建议是：**在声明和语句之间留出一个空行** 。

C99 中，声明可以不在语句之前。但是为了和以前的编译器兼容，暂时不采用这一规则。但是 C++ 和 Java 程序中在使用时才声明变量的情况很常见。

### 2.4.3 赋值

变量通过赋值的方式获得值。**字面量都是常量** 。

变量在赋值或者以其他方式使用之前必须先声明：

```C
int height;
height = 8;
```

当我们把一个包含小数点的常量赋值给浮点型类型的变量时， **最好在该常量的后面加一个字母 `F`** ：`float height = 3.14F;` 。不加可能会引发编译器的警告，因为小数字面值的默认类型是 `double` 。

混合类型赋值是可以的，但是不一定安全。

### 2.4.4 显示变量的值

占位符 `%f` 默认情况下会显示小数点的后 `6` 位数字。

### 2.4.5 初始化

当程序开始执行时，某些变量会被自动的设置为 `0`，而大多数变量则不会。**没有默认值并且尚未在程序中被赋值的变量是未初始化的** 。

试图访问未初始化的变量，可能会得到不可预知的结果。访问未初始化的变量是为定义的行为。

可以在变量声明中加入初始值，来初始化声明的对象。

### 2.4.6 显示表达式的值

`printf` 的功能不仅局限于显示变量中存储的数，它可以显示任意数值表达式的值。

C 语言的一个通用原则：**在任何需要数值的地方，都可以使用具有相同类型的表达式** 。

## 2.5 读入输入

为了获取输入，就要用到 `scanf` 函数。它是 C 函数库中与 `printf` 函数相对应的函数。`scanf` 中的字母 `f` 和 `printf` 中的字母 `f` 含义相同，都是表示 **格式化（ format ）** 的意思。`scanf` 函数和 `printf` 函数都需要使用 **格式字符串** 来指定输入或者输出的数据形式。 **<u>`scanf` 函数需要知道将获得的输入数据的格式，而 `printf` 函数需要知道输出数据的显示格式</u>** 。

## 2.6 定义常量的名字

采用 **宏定义** 的特性来给常量命名：

```C
#define INCHES_PER_POUND 166
```

这里使用的还是预处理指令，类似于前面的 `#include` ，行尾也没有分号。

当宏定义包含运算符时， **这个表达式必须使用括号括起来** 。

注意， **宏的名字只使用大写字母** 。这个规范已经几十年，希望读者不要打破。

## 2.7 标识符

**变量、函数、宏 和 其他实体的名字** 叫做 **标识符** 。标识符可以含有字母、数字和下划线，但是 **必须以 字母 或者 下划线 开头** 。

C 语言的标识符是区分大小写的。

命名风格最好使用 **下划线方法** ，并且坚持一种风格即可。

C 语言对标识符的最大长度没有限制，所以不必担心使用较长的描述性名字。

#### 关键字

## 2.8 C 程序的书写规范

我们可以把 C 程序看成一连串的 **记号（ token ）** ，即 **许多在不改变意思的基础上无法再分割的字符组** 。标识符和关键字都是记号。

添加足够多的空格和空行可以使程序更便于阅读和理解。这一规则对于程序布局有如下积极意义：

* 语句可以分开放在任意多行内。
* 记号间的空格使我们更容易区分记号，通常会在每个运算符的前后都放上一个空格。
* 缩进有助于识别程序的嵌套。
* 空行可以把程序划分成逻辑单元。