# 第6章 循环

循环是重复执行其他语句（循环体）的一种语句。C 语言中，每个循环都有一个 **控制表达式** 。 **每次执行循环体（循环重复一次）时都要对控制表达式求值** 。如果表达式为真（即值不为零），那么继续执行循环。

C 语言提供了三种重复语句，即 `while` 语句，`do` 语句和 `for` 语句。

`while` 循环在循环体之前测试控制表达式，`do` 循环在至少执行一次循环体之后测试控制表达式，`for` 语句则非常适合那些递增或者递减计数变量的循环。

## 6.1 `while` 语句

`while (表达式) 语句`

执行 `while` 语句时，首先 **计算控制表达式的值** 。如果 **值不为 `0`**（即为真），那么 **执行循环体** ，接着 **再次判定表达式** 。这个过程（先判定控制表达式，再执行循环体）持续直到控制表达式的值为 `0` 才停止。

#### 无限循环

如果控制表达式的值始终非零，`while` 语句将无法中止。

## 6.2 `do` 语句

`do` 语句的本质就是 `while` 语句，只不过其控制表达式是在每次循环体执行完毕之后才进行判定的（换句话说，`do` 循环必然至少执行一次）。

```C++
do {
    ...
} while ( ... );
```

**必须给所有 `do` 语句都加上花括号** ，这是因为没有花括号的 `do` 语句很容易被误认为是 `while` 语句。

## 6.3 `for` 语句

`for` 语句格式：`for (表达式1; 表达式2; 表达式3) 语句`

等价的 `while` 循环：

```C++
表达式1;
while (表达式2) {
    语句
    表达式3;
}
```

**表达式1 是循环开始执行前的初始化步骤，只执行一次；表达式2 用来控制循环的终止（只要 表达式2 的值不为零，循环持续执行）；而 表达式3 是每次循环体执行完毕之后才执行的一个操作** 。

### 6.3.1 `for` 语句的惯用法

```C++
for (i = 0; i < n; ++i) { ... } // 从 0 向上加到 n-1
for (i = 1; i <= n; ++i) { ... } // 从 1 向上加到 n
for (i = n - 1; i >= 0; --i) { ... } // 从 n-1 向下减到 0
for (i = n; i > 0; --i) { ... } // 从 n 向下减到 1
```

> 这里要当心循环次数差 1 的问题。

### 6.3.2 在 `for` 语句中省略表达式

`for` 语句允许省去任意数量（ 0 到 3 ）的表达式。

如果省略 表达式2 ，那么它的默认值为 `true` ，因此 `for` 语句不会自己靠语言机制停下来，必须借助 `return` ，`break` 等语句才能跳出循环。

### 6.3.3 C99 中的 `for` 语句

在 C99 中，`for` 语句的第一个表达式可以替换为一个声明，这一特性使得程序员可以声明一个只用于循环的的变量：

```C++
// int i = 0方式为 C99 专属，循环变量 i 在循环外不可见
for (int i = 0; i < n; ++i) { ... }
```

让 `for` 语句声明自己的循环控制变量通常是一个好办法：这样很方便且程序的可读性更强。

`for` 语句语句可以声明多个变量，只要它们类型相同。

### 6.3.4 逗号运算符

`表达式1, 表达式2`

这里的 表达式1 和 表达式2 是两个任意的表达式。逗号表达式的计算要通过两步来实现：

1. 计算 表达式1 并且丢弃计算出来的值。
2. 计算 表达式2，把这个值作为整个表达式的值返回。

这里对于 表达式1 的计算应该始终都会有副作用；如果没有，那么 表达式1 的存在是没有意义的。

提供 **逗号运算符** 是为了在 C 语言要求 **只能有一个表达式的情况下可以使用两个或者多个表达式** 。逗号运算符允许将两个表达式连接在一起构成一个表达式。

## 6.4 退出循环

* `continue` 语句：跳过某次迭代的部分内容，但是不会跳出整个循环。
* `goto` 语句：允许程序从一条语句跳转到另一条语句。

### 6.4.1 `break` 语句

**对于退出点在循环体的中间而不是循环体之前或者之后的情况** ，`break` 语句特别有用。

`break` 语句把程序控制从包含该语句的最内层 `while` 、`do` 、`for` 或者 `switch` 语句中转移出来。**<u>因此，当这些语句出现嵌套时，`break` 语句只能跳出一层嵌套</u>** 。

### 6.4.2 `continue` 语句

`break` 语句是把程序控制转移到循环体末尾之后，而 `continue` 语句是把程序控制转移到循环体末尾之前。

`break` 和 `continue` 的一个区别是：`break` 语句可以用于 `switch` 语句和循环，而 `continue` 只能用于循环。

### 6.4.3 `goto` 语句

`goto` 语句可以跳转到函数中任何有标号的语句处。（ C99 中增加了一条限制： `goto` 语句不可以用于绕过变成数组的声明）

标号只是放置在语句开始处的标识符：`标识符 : 语句` 。

`goto` 语句的自身格式如下：`goto : 标识符;` 。

**`goto` 语句可以跳出多重循环嵌套的语句群** 。

## 6.5 空语句

语句可以为空，就是除了末尾处的分号以外什么符号也没有。

空语句的主要作用之一就是编写空的循环体。